#!/usr/bin/env python3
"""
Check Trading Signals Generated by Kimera AI
"""

import os
import sys
import asyncio

# Add backend to path
sys.path.append(os.path.join(os.path.dirname(__file__), 'backend'))

from src.trading.autonomous_kimera_trader import create_autonomous_kimera

async def check_signals():
    """Check what trading signals Kimera is generating"""
    logger.info("üß† CHECKING KIMERA TRADING SIGNALS")
    logger.info("=" * 50)
    
    try:
        # Create trader
        API_KEY = os.getenv("CDP_API_KEY_NAME", "")
        trader = create_autonomous_kimera(API_KEY, target_eur=100.0)
        
        # Symbols to analyze
        symbols = ['bitcoin', 'ethereum', 'solana', 'cardano', 'polkadot']
        
        logger.info("üìä ANALYZING MARKET CONDITIONS...")
        
        for symbol in symbols:
            logger.info(f"\nüîç {symbol.upper()}:")
            
            # Fetch market data
            df = await trader.fetch_market_data(symbol)
            if df.empty:
                logger.info("   ‚ùå No market data")
                continue
            
            # Analyze market regime
            regime = trader.analyze_market_regime(symbol)
            logger.info(f"   üìà Market Regime: {regime.value}")
            
            # Generate signal
            signal = trader.generate_cognitive_signal(symbol)
            
            if signal:
                logger.info(f"   üéØ ACTION: {signal.action}")
                logger.info(f"   üìä Confidence: {signal.confidence:.2f}")
                logger.info(f"   üí™ Conviction: {signal.conviction:.2f}")
                logger.info(f"   üß≠ Strategy: {signal.strategy.value}")
                logger.info(f"   üí∞ Allocation: {signal.suggested_allocation_pct:.1f}%")
                logger.info(f"   üéØ Entry Price: ‚Ç¨{signal.entry_price:.2f}")
                
                # Check if would execute
                if signal.confidence > 0.6:
                    logger.info("   ‚úÖ WOULD EXECUTE (confidence > 60%)")
                else:
                    logger.info(f"   ‚ùå Would NOT execute (confidence {signal.confidence:.1%} < 60%)")
                    
                logger.info(f"   üí≠ Reasoning: {signal.reasoning}")
                
            else:
                logger.info("   ‚ö™ No signal generated (HOLD)")
        
        # Show current portfolio status
        logger.info(f"\nüìà PORTFOLIO STATUS:")
        status = await trader.get_portfolio_status()
        logger.info(f"   üí∞ Value: ‚Ç¨{status['portfolio_value_eur']:.2f}")
        logger.info(f"   üìä Progress: {status['progress_pct']:.1f}%")
        logger.info(f"   üéØ Active Positions: {status['active_positions']}")
        logger.info(f"   üìà Total Trades: {status['total_trades']}")
        
        # Check if any high-confidence signals exist
        high_confidence_count = 0
        for symbol in symbols:
            df = await trader.fetch_market_data(symbol)
            if not df.empty:
                signal = trader.generate_cognitive_signal(symbol)
                if signal and signal.confidence > 0.6:
                    high_confidence_count += 1
        
        logger.info(f"\nüöÄ SUMMARY:")
        logger.info(f"   High Confidence Signals: {high_confidence_count}/{len(symbols)}")
        
        if high_confidence_count == 0:
            logger.info("   üí° REASON FOR NO TRADES: Market conditions don't meet AI confidence thresholds")
            logger.info("   üß† AI is waiting for better opportunities")
            logger.info("   ‚öôÔ∏è To trade more aggressively, lower confidence threshold to 40-50%")
        else:
            logger.info("   üéØ Signals available but system may be in simulation mode")
            
    except Exception as e:
        logger.info(f"‚ùå Error: {e}")
        import traceback
import logging
logger = logging.getLogger(__name__)
        traceback.print_exc()

if __name__ == "__main__":
    asyncio.run(check_signals()) 